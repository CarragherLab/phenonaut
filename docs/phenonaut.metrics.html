<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>phenonaut.metrics package &mdash; Phenonaut 1.3.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="phenonaut.output package" href="phenonaut.output.html" />
    <link rel="prev" title="phenonaut.data package" href="phenonaut.data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Phenonaut
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="phenonaut.html">API documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="phenonaut.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="phenonaut.data.html">phenonaut.data package</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">phenonaut.metrics package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-phenonaut.metrics.distances">phenonaut.metrics.distances module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-phenonaut.metrics.measures">phenonaut.metrics.measures module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-phenonaut.metrics.non_ds_phenotypic_metrics">phenonaut.metrics.non_ds_phenotypic_metrics module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-phenonaut.metrics.performance">phenonaut.metrics.performance module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-phenonaut.metrics.utils">phenonaut.metrics.utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-phenonaut.metrics">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="phenonaut.output.html">phenonaut.output package</a></li>
<li class="toctree-l3"><a class="reference internal" href="phenonaut.packaged_datasets.html">phenonaut.packaged_datasets package</a></li>
<li class="toctree-l3"><a class="reference internal" href="phenonaut.predict.html">phenonaut.predict package</a></li>
<li class="toctree-l3"><a class="reference internal" href="phenonaut.transforms.html">phenonaut.transforms package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="phenonaut.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="phenonaut.html#module-phenonaut.phenonaut">phenonaut.phenonaut module</a></li>
<li class="toctree-l2"><a class="reference internal" href="phenonaut.html#module-phenonaut.utils">phenonaut.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="phenonaut.html#module-phenonaut.workflow">phenonaut.workflow module</a></li>
<li class="toctree-l2"><a class="reference internal" href="phenonaut.html#module-phenonaut">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="userguide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="publication_examples.html">Publication examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow_guide.html">Workflow mode</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Phenonaut</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="phenonaut.html">phenonaut package</a></li>
      <li class="breadcrumb-item active">phenonaut.metrics package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/phenonaut.metrics.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="phenonaut-metrics-package">
<h1>phenonaut.metrics package<a class="headerlink" href="#phenonaut-metrics-package" title="Permalink to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this heading"></a></h2>
</section>
<section id="module-phenonaut.metrics.distances">
<span id="phenonaut-metrics-distances-module"></span><h2>phenonaut.metrics.distances module<a class="headerlink" href="#module-phenonaut.metrics.distances" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.distances.euclidean">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.distances.</span></span><span class="sig-name descname"><span class="pre">euclidean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point1</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">point2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.distances.euclidean" title="Permalink to this definition"></a></dt>
<dd><p>Measure the euclidean distance between 2 points</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>point1</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><em>float</em><em>]</em><em>,</em><em>np.ndarray</em><em>, </em><em>pd.DataFrame</em><em>]</em>) – Multidimensional point, can be a simple list of [x,y,z], or a 2d M*N
list where M are multiple points to be individually measured of N
features and returning an array of measurmenents for each point.</p></li>
<li><p><strong>point2</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><em>List</em><em>[</em><em>float</em><em>]</em><em>]</em><em>, </em><em>np.ndarray</em><em>, </em><em>pd.DataFrame</em><em>]</em>) – List of N features, must have 1 dimension.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array (if point is 2D) of distances. If 1D, then single float value is
returned indicating the euclidean distance between point1 and point2.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[np.ndarray, float]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>DataError</strong> – Point1 can be 2D, but not 3D, and point2 must be 1D</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.distances.mahalanobis">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.distances.</span></span><span class="sig-name descname"><span class="pre">mahalanobis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cloud</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pvals</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">covariance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">EmpiricalCovariance</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">MinCovDet</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">EmpiricalCovariance()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.distances.mahalanobis" title="Permalink to this definition"></a></dt>
<dd><p>Measure the Mahalanobis distance between a point and a cloud</p>
<p>The Mahalanobis distance calculation is particularly sensitive to outliers,
which results in large changes in covariance matrix calculation. For this
reason, robust covarience estimators may be suppplied to the method. Whilst
a common recomendation is to calculate the sqrt of the Mahalanobis distance,
this is an approximation to euclidean space, only correct when the covariance
matrix is an identity matrix. As Phenonaut is concerned on operating on high
dimensional space which very likely has covariences present, the returned
distance is not square rooted, returning D2 as noted.</p>
<p><a class="reference external" href="https://imaging.mrc-cbu.cam.ac.uk/statswiki/FAQ/euclid">https://imaging.mrc-cbu.cam.ac.uk/statswiki/FAQ/euclid</a></p>
<p>Optionally, the p-value for the point or points belonging to the cloud can
be returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>point</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><em>float</em><em>]</em><em>,</em><em>np.ndarray</em><em>, </em><em>pd.DataFrame</em><em>]</em>) – Multidimensional point, can be a simple list of features, or a 2d M*N
list where M are multiple points to be individually measured of N
features and returning an array of measurmenents for each point.</p></li>
<li><p><strong>cloud</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><em>List</em><em>[</em><em>float</em><em>]</em><em>]</em><em>, </em><em>np.ndarray</em><em>, </em><em>pd.DataFrame</em><em>]</em>) – 2D M*N array-like set of M points, with N features from which the
underlying target distribution will be measured.</p></li>
<li><p><strong>pvals</strong> (<em>bool</em>) – If True, then p-value for the point (or points) belonging to cloud is returned.
This is calculated using Chi2 and degrees of freedom calculated as
N-1, where N is the number of features/dimensions. If point was one
dimensional, then a single floating point value is returned. If it is 2D
(MxN matrix), then an array of length M is returned. By default, False.</p></li>
<li><p><strong>covariance</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>np.ndarray</em><em>, </em><em>EmpiricalCovariance</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – If none, then the covariance matrix is calculated using scikit’s
EmpiricalCovariance. This is fairly robust to outliers, and much more robust
than the standard approach to calculating a covariance matrix (using numpy’s
np.cov method. Robust estimators may be used by passing in an instantiated
object which a subclass of EmpiracalCovariance (like
sklearn.covariance.MinCovDet or EmpiricalCovariance itself). If None, then
numpy’s cov method is used (sensitive to outliers). By default EmpiracalCovariance().</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array (if point is 2D) of distances. If 1D, then single float value is
returned indicating the Mahalanobis distance of the point to the
cloud.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[np.ndarray, float]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.distances.manhattan">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.distances.</span></span><span class="sig-name descname"><span class="pre">manhattan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point1</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">point2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.distances.manhattan" title="Permalink to this definition"></a></dt>
<dd><p>Measure the Manhattan distance between 2 points</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>point1</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><em>float</em><em>]</em><em>,</em><em>np.ndarray</em><em>, </em><em>pd.DataFrame</em><em>]</em>) – Multidimensional point, can be a simple list of [x,y,z], or a 2d M*N
list where M are multiple points to be individually measured of N
features and returning an array of measurmenents for each point.</p></li>
<li><p><strong>point2</strong> (<em>Union</em><em>[</em><em>List</em><em>[</em><em>List</em><em>[</em><em>float</em><em>]</em><em>]</em><em>, </em><em>np.ndarray</em><em>, </em><em>pd.DataFrame</em><em>]</em>) – List of N features, must have 1 dimension.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array (if point is 2D) of distances. If 1D, then single float value is
returned indicating the euclidean distance between point1 and point2.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[np.ndarray, float]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>DataError</strong> – Point1 can be 2D, but not 3D, and point2 must be 1D</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.distances.treatment_spread_euclidean">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.distances.</span></span><span class="sig-name descname"><span class="pre">treatment_spread_euclidean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><span class="pre">Dataset</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">perturbation_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perturbations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict[slice(&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">&lt;class</span> <span class="pre">'float'&gt;,</span> <span class="pre">None)]</span></span></span><a class="headerlink" href="#phenonaut.metrics.distances.treatment_spread_euclidean" title="Permalink to this definition"></a></dt>
<dd><p>Calculate the euclidean spreat of perturbation repeats</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dict[str</strong> – Dictionary with perturbations as keys and euclidean distances as values.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>DataError</strong> – Perturbation column was not set for the given Dataset and was not
    supplied via the perturbation_column argument to
    treatment_spread_euclidean.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-phenonaut.metrics.measures">
<span id="phenonaut-metrics-measures-module"></span><h2>phenonaut.metrics.measures module<a class="headerlink" href="#module-phenonaut.metrics.measures" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.measures.feature_correlation_to_target">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.measures.</span></span><span class="sig-name descname"><span class="pre">feature_correlation_to_target</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><span class="pre">Dataset</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="phenonaut.html#phenonaut.phenonaut.Phenonaut" title="phenonaut.phenonaut.Phenonaut"><span class="pre">Phenonaut</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_feature</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'pearson'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_dataframe</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.measures.feature_correlation_to_target" title="Permalink to this definition"></a></dt>
<dd><p>Calculate correlation coefficients for features to a column</p>
<p>Sometimes we may wish to identify highly correlated features with a given
property.</p>
<p>In this example, we use a subset of the Iris dataset:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>sepal length (cm)</p></th>
<th class="head"><p>sepal width (cm)</p></th>
<th class="head"><p>petal length (cm)</p></th>
<th class="head"><p>petal width (cm)</p></th>
<th class="head"><p>target</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>5.4</p></td>
<td><p>3.4</p></td>
<td><p>1.7</p></td>
<td><p>0.2</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>7.2</p></td>
<td><p>3.0</p></td>
<td><p>5.8</p></td>
<td><p>1.6</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>6.4</p></td>
<td><p>2.8</p></td>
<td><p>5.6</p></td>
<td><p>2.1</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>4.8</p></td>
<td><p>3.1</p></td>
<td><p>1.60</p></td>
<td><p>2</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>5.6</p></td>
<td><p>2.5</p></td>
<td><p>3.9</p></td>
<td><p>1.1</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>We may wish to determine which feature is correlated with the
“petal length (cm)” which can be achieved through calling this
feature_correlation_to_target function, alowing the return of a pd.DataFrame
or simple dictionary containing features names as keys, and the coefficients
as values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">phenonaut</span> <span class="kn">import</span> <span class="n">Phenonaut</span>
<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp</span><span class="p">:</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;sepal length (cm),sepal width (cm),petal length (cm),petal width (cm),target</span><span class="se">\n</span><span class="s2">5.4,3.4,1.7,0.2,0</span><span class="se">\n</span><span class="s2">7.2,3.0,5.8,1.6,2</span><span class="se">\n</span><span class="s2">6.4,2.8,5.6,2.1,2</span><span class="se">\n</span><span class="s2">4.8,3.1,1.60,2,0</span><span class="se">\n</span><span class="s2">5.6,2.5,3.9,1.1,1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">phe</span><span class="o">=</span><span class="n">Phenonaut</span><span class="p">()</span>
    <span class="n">phe</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;Flowers&quot;</span><span class="p">,</span><span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;features_regex&#39;</span><span class="p">:</span><span class="s2">&quot;.*(width|length).*&quot;</span><span class="p">})</span>

<span class="kn">from</span> <span class="nn">phenonaut.metrics</span> <span class="kn">import</span> <span class="n">feature_correlation_to_target</span>
<span class="nb">print</span><span class="p">(</span><span class="n">feature_correlation_to_target</span><span class="p">(</span><span class="n">phe</span><span class="p">,</span> <span class="s1">&#39;petal length (cm)&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Returns a pd.DataFrame containing correlation coefficients:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>index</p></th>
<th class="head"><p>correlation_to_petal length (cm)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sepal length (cm)</p></td>
<td><p>0.914639</p></td>
</tr>
<tr class="row-odd"><td><p>petal width (cm)</p></td>
<td><p>0.448289</p></td>
</tr>
<tr class="row-even"><td><p>sepal width (cm)</p></td>
<td><p>-0.544665</p></td>
</tr>
</tbody>
</table>
<p>The optional dictionary, returned by calling the function with the additional return_dataframe parameter set to False:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">feature_correlation_to_target</span><span class="p">(</span><span class="n">phe</span><span class="p">,</span> <span class="s1">&#39;petal length (cm)&#39;</span><span class="p">),</span> <span class="n">return_dataframe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>has the form:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;petal width (cm)&#39;</span><span class="p">:</span> <span class="mf">0.448289248746271</span><span class="p">,</span> <span class="s1">&#39;sepal length (cm)&#39;</span><span class="p">:</span> <span class="mf">0.9146393603234955</span><span class="p">,</span> <span class="s1">&#39;sepal width (cm)&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5446646166252519</span><span class="p">}</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<em>Union</em><em>[</em><a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><em>Dataset</em></a><em>, </em><a class="reference internal" href="phenonaut.html#phenonaut.phenonaut.Phenonaut" title="phenonaut.phenonaut.Phenonaut"><em>Phenonaut</em></a><em>, </em><em>DataFrame</em><em>]</em>) – The Phenonaut Dataset, pd.DataFrame, or Phenonaut object (containing only
one dataset) on which to perform correlation calculations.</p></li>
<li><p><strong>target_feature</strong> (<em>str</em>) – The feature, or metadata column that all correlations should be calculated against.</p></li>
<li><p><strong>features</strong> (<em>Optional</em><em>[</em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – List of features to include in the correlation calculations. If None,
and a Dataset is supplied then those features are used. In the case where
a pd.DataFrame is supplied, then features must be supplied. By default None.</p></li>
<li><p><strong>method</strong> (<em>str</em><em>, </em><em>optional</em>) – Method used to calculate the correlation coefficient. Can be ‘pearson’,
‘kendall’ for the Kendall Tau correlation coefficient, or ‘spearman’ for
the Spearman rank correlation. By default “pearson”.</p></li>
<li><p><strong>return_dataframe</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, then a pd.DataFrame containing correlations is returned. If False,
then a dictionary is returned, containing features names as keys, and
the coefficients as values. By default True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Return a pd.DataFrame with calculated correlation coefficients, or
alternatively, a dictionary containing features names as keys, and the
coefficients as values.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[pd.Datframe, dict]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – Phenonaut objects must contain only one dataset if passed to this
    function.</p></li>
<li><p><strong>ValueError</strong> – Target feature not found in the supplied dataset.</p></li>
<li><p><strong>ValueError</strong> – DataFrame supplied, but no features.</p></li>
<li><p><strong>ValueError</strong> – target_feature not found in the dataset.</p></li>
<li><p><strong>TypeError</strong> – Supplied dataset was not of type Phenonaut, Dataset, or pd.DataFrame</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.measures.scalar_projection">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.measures.</span></span><span class="sig-name descname"><span class="pre">scalar_projection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><span class="pre">Dataset</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_perturbation_column_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'control'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_perturbation_column_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'pos'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_column_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'pos'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.measures.scalar_projection" title="Permalink to this definition"></a></dt>
<dd><dl class="simple">
<dt>Calculates the scalar projection and scalar rejection, quantifying on and</dt><dd><p>off target phenotypes, as used in:
Heiser, Katie, et al. “Identification of potential treatments for
COVID-19 through artificial intelligence-enabled phenomic analysis of
human cells infected with SARS-CoV-2.” BioRxiv (2020).</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><em>Dataset</em></a>) – Phenonaut dataset being queries</p></li>
<li><p><strong>target_TreatmentID</strong> (<em>[</em><em>type</em><em>]</em>) – TreatmentID of target phenotype. The median of all features across wells
containing this phenotype is used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-phenonaut.metrics.non_ds_phenotypic_metrics">
<span id="phenonaut-metrics-non-ds-phenotypic-metrics-module"></span><h2>phenonaut.metrics.non_ds_phenotypic_metrics module<a class="headerlink" href="#module-phenonaut.metrics.non_ds_phenotypic_metrics" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.non_ds_phenotypic_metrics.</span></span><span class="sig-name descname"><span class="pre">PhenotypicMetric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">range</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">higher_is_better</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Metrics evaluate one profile/feature vector against another</p>
<p>SciPy and other libraries traditionally supply distance metrics, like
Manhattan, Euclidean etc. These are typically unbound in their max value,
but not always, for example; cosine distance with a maximum dissimilarity of
1.  Scientific literature is also full of similarity metrics, where a high
value indicates most similarity - the opposite of a similarity metric. This
dataclass coerces metrics into a standard form, with .similarity and
.distance functions to turn any metric into a similarity or distance metric.</p>
<p>This allows the definition of something like the Zhang similarity metric,
which ranges from -1 to 1, indicating most dissimilarity and most similarity
respectively. Calling the metric defined by this Zhang function will return
the traditional Zhang metric value - ranging from -1 to 1.</p>
<p>The methods similarity and distance will also be added</p>
<p>Calling distance will return a value between 0 and 1, with 0 being most
similar and 1 being most dissimilar.</p>
<p>Calling similarity will return a value between 0 and 1, with 1 being the
most similar and 0 being the most different.</p>
<dl class="py method">
<dt class="sig sig-object py" id="phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">anchor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric.__call__" title="Permalink to this definition"></a></dt>
<dd><p>Call self as a function.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric.distance">
<span class="sig-name descname"><span class="pre">distance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">anchor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric.distance" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric.scale">
<span class="sig-name descname"><span class="pre">scale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">score</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric.scale" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric.similarity">
<span class="sig-name descname"><span class="pre">similarity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">anchor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric.similarity" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.non_ds_phenotypic_metrics.calc_connectivity_scores">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.non_ds_phenotypic_metrics.</span></span><span class="sig-name descname"><span class="pre">calc_connectivity_scores</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">anchor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">queries</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span></span></span><a class="headerlink" href="#phenonaut.metrics.non_ds_phenotypic_metrics.calc_connectivity_scores" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.non_ds_phenotypic_metrics.calc_spearmansrank_scores">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.non_ds_phenotypic_metrics.</span></span><span class="sig-name descname"><span class="pre">calc_spearmansrank_scores</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">anchor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">queries</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span></span></span><a class="headerlink" href="#phenonaut.metrics.non_ds_phenotypic_metrics.calc_spearmansrank_scores" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.non_ds_phenotypic_metrics.calc_zhang_scores">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.non_ds_phenotypic_metrics.</span></span><span class="sig-name descname"><span class="pre">calc_zhang_scores</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">anchor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">queries</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">ndarray</span></span></span><a class="headerlink" href="#phenonaut.metrics.non_ds_phenotypic_metrics.calc_zhang_scores" title="Permalink to this definition"></a></dt>
<dd><p>Calculate Zhang scores between two np.ndarrays</p>
<p>Implementation of the Zhang method for comparing L1000/CMAP signatures.
Zhang, Shu-Dong, and Timothy W. Gant. “A simple and robust method for
connecting small-molecule drugs using gene-expression signatures.” BMC
bioinformatics 9.1 (2008): 1-10.
Implemented by Steven Shave, following above paper as a reference
<a class="reference external" href="https://doi.org/10.1186/1471-2105-9-258">https://doi.org/10.1186/1471-2105-9-258</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>anchor</strong> (<em>np.array</em>) – Anchor profiles/features. Can be a MxN matrix, allowing M sequences to
be queried against queries (using N features).</p></li>
<li><p><strong>queries</strong> (<em>np.array</em>) – Candidate profiles/features. Can be a MxN matrix, allowing M candidate
sequences to be evaluated against anchor sequences.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>If anchor and candidate array ndims are both 1, then a single float
representing the Zhang score is returned. If one input array has ndims
of  2 (and the other has ndims of 1), then a 1-D np.ndarray is
returned. If both inputs are 2-D, then a 2D MxN array is returned, where
M is the</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[float, np.ndarray]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.non_ds_phenotypic_metrics.calc_zhang_scores_all_v_all">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.non_ds_phenotypic_metrics.</span></span><span class="sig-name descname"><span class="pre">calc_zhang_scores_all_v_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">anchor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.non_ds_phenotypic_metrics.calc_zhang_scores_all_v_all" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-phenonaut.metrics.performance">
<span id="phenonaut-metrics-performance-module"></span><h2>phenonaut.metrics.performance module<a class="headerlink" href="#module-phenonaut.metrics.performance" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.performance.percent_compact">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.performance.</span></span><span class="sig-name descname"><span class="pre">percent_compact</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><span class="pre">Dataset</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="phenonaut.html#phenonaut.phenonaut.Phenonaut" title="phenonaut.phenonaut.Phenonaut"><span class="pre">Phenonaut</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perturbation_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replicate_criteria</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replicate_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replicate_criteria_not</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">null_query_or_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">null_criteria</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">null_criteria_not</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restrict_evaluation_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'spearman'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric_higher_is_better</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_cardinality</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_cardinality</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_cardinality_violating_compounds_in_calculation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_full_performance_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">additional_captured_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">performance_df_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile_cutoff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_joblib_parallelisation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.performance.percent_compact" title="Permalink to this definition"></a></dt>
<dd><p>Calculate percent compact</p>
<p>Compactness is defined by the spread of compound repeats compared to a randomly sampled
background distribution.  For a given compound, its cardinality (num replicates), reffered
to as C is determined. Then the median distance of all replicates is determined. This is then
compared to a randomly sampled background. This background is obtained as follows: select C
random compounds, calculate their median pairwise distances to each other, and store this.
Repeat the process 1000 times and build a distribution of matched cardinality to the
replicating compound.  The replicate treatments are deemed compact if its score is less than
the 5th percentile of the background distribution (for distance metrics), and greater than
the 95th percentile for similarity metrics.  Percent compact is simply the percentage of
compounds which pass this compactness test.</p>
<p>Matching distributions are created by matching perturbations. In Phenonaut, this is
typically defined by the perturbation_column field. This function takes this field as an
argument, although it is unused if found in the passed Dataset/Phenonaut object. Additional
criterial to match on such as concentration and well position can be added using the
replicate_criteria argument. Null distributions are composed of a pick of C unique compounds,
where C is the cardinality of the matched repeats (how many), and their median ‘similarity’.
By default, this similarity is the spearman correlation coefficient between profiles. This
process to generate median similarity for non-replicate compounds is repeated n_iters times
(by default 1000).</p>
<p>As the calculation is demanding, the function makes use of the joblib library for parallel
calculation of the null distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>Union</em><em>[</em><a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><em>Dataset</em></a><em>, </em><a class="reference internal" href="phenonaut.html#phenonaut.phenonaut.Phenonaut" title="phenonaut.phenonaut.Phenonaut"><em>Phenonaut</em></a><em>, </em><em>pd.DataFrame</em><em>]</em><em>,</em>) – Input data in the form of a Phenonaut dataset, a Phenonaut object, or a pd.DataFrame
containing profiles of perturbations. If a Phenonaut object is supplied, then the last added
Dataset will be used.</p></li>
<li><p><strong>perturbation_column</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em>) – This argument sets the column name containing an identifier for the perturbation name (or
identifier), usually the name of a compound or similar. If a Phenonaut object or Dataset is
supplied as the ds argument and this perturbation_column argument is None, then this value is
attempted to be discovered through interrogation of the perturbation_column property of the
Dataset. In the case of the CMAP_Level4 PackagedDataset, a standard run would be achieved by
passing ‘pert_iname’as an argument here, or disregarding the value found in this argument by
providing a dataset with the perturbation_column property already set.</p></li>
<li><p><strong>replicate_criteria</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>]</em><em>=None</em>) – As noted above describing the impact of the perturbation_column argument, matching compounds
are often defined by their perturbation name/identifier and dose.  Whilst the perturbation
column matches the compound name/identifier (something which must always be matched), passing
a string here containing the title of a dose column (for example) also enforces matching on
this property. A list of strings may also be passed. In the case of the PackagedDataset
CMAP_Level4, this argument would take the value “pert_idose_uM” and would ensure that
matched replicates share a common identifier/name (as default and enforced by
perturbation_column) and concentration. The original perturbation_column may be included
here but has no effect. By default None.</p></li>
<li><p><strong>replicate_query</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em><em>=None</em>) – Optional pandas query to apply in selection of the matching replicates, this maybe something
like ensuring concentration is above a threshold, or that they are taken from certain timepoints.
Please note, if information in rows is never going to be included in matching or null distributions,
then it is more efficient to prefilter the dataframe before running compactness on it.
This parameter should not be used to restrict the compounds on which compactness is run,
as this is inefficient. Instead, the restrict_evaluation_query should be used.</p></li>
<li><p><strong>replicate_criteria_not</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>]</em><em>=None</em>) – Values in this list enforce that matching replicates do NOT share a common property. This is
useful for exotic evaluations, like picking replicates from across cell lines and
concentrations.</p></li>
<li><p><strong>null_query_or_df</strong> (<em>Optional</em><em>[</em><em>str</em><em>, </em><em>pd.DataFrame</em><em>]</em><em>=None</em>) – Optional pandas query to apply in selection of the non-matching replicates comprising the null
distribution. This can be things like ensuring only a certain plates or cell lines are used in
construction of the distribution. Alternatively, a pd.DataFrame may be supplied here, from which
the non-matching compounds are drawn for creation of the null distribution. Note; if
supplying a query to filter out information in rows that is never going to be included in
matching or null distributions, then it is more efficient to prefilter the dataframe before
running compactness on it. This argument does not override null_criteria, or
null_criteria_not as these have effect after this arguments effects have been applied. Has no
effect if None. By default, None.</p></li>
<li><p><strong>null_criteria</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>]</em>) – Whilst matching compounds are often defined by perturbation and dose, compounds comprising the
null distribution must sometimes match the well position of the original compound. This
argument captures the column name defining properties of non-matching replicates which must
match the orignal query compound. In the case of the CMAP_Level4 PackagedDataset, this
argument would take the value “well”. A list of strings may also be passed to enforce further
fields within the matching distribution which must match in the null distribution. If None,
then no requirements appart from a different name/compound idenfier are enforced. By default
None.</p></li>
<li><p><strong>null_criteria_not</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>]</em>) – Values in this list enforce that matching non-replicates do NOT share a common property with
the chosen replicates. The opposite of the above described null_criteria, this
allows exotic evaluations like picking replicates from different cell lines to the matching
replicates. Has no effect if None. By default None.</p></li>
<li><p><strong>restrict_evaluation_query</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em><em>, </em><em>optional</em>) – If only a few compounds in a Phenonaut Dataset are to be included in the compactness
calculation, then this parameter may be used to efficiently select only the required compounds
using a standard pandas style query which is run on groups defined by replicate_criteria
Excluded compounds are not removed from the compactness calculation.  If None, then has
no effect. By default None.</p></li>
<li><p><strong>features</strong> (<em>features:Optional</em><em>[</em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em>) – Features list which capture the phenotypic responses to perturbations. Only required and used
if a pd.DataFrame is supplied in place of the ds argument. By default None.</p></li>
<li><p><strong>n_iters</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of times the non-matching compound replicates should be sampled to compose the null
distribution. If less than n_iters are available, then take as many as possible. By default
1000.</p></li>
<li><p><strong>similarity_metric</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>Callable</em><em>, </em><a class="reference internal" href="#phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric" title="phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric"><em>PhenotypicMetric</em></a><em>]</em><em>, </em><em>optional</em>) – Callable metric, or string which is passed to pdist. This should be a
distance metric; that is, lower is better, higher is worse.
Note, a special case exists, whereby ‘spearman’ may be supplied here
if so, then a much faster Numpy method np.corrcoef is used, and then results
are subtracted from 1 to turn the metric into a distance metric. By default ‘spearman’.</p></li>
<li><p><strong>similarity_metric_higher_is_better</strong> (<em>bool</em>) – If True, then a high value from the supplied similarity metric is better. If False, then
a lower value is better (as is the case for distance metrics like Euclidean/Manhattan etc).
Note that if lower is better, then the percentile should be changed to the other end of the
distribution. For example, if keeping with significance at the 5 % level for a metric for
which higher is better, then a metric where lower is better would use the 5th percentile,
and percentile_cutoff = 5 should be used. By default True.</p></li>
<li><p><strong>min_cardinality</strong> (<em>int</em>) – Cardinality is the number of times a treatment is repeated (treatment with matching well,
dose and any other constraints imposed). This arguments sets the minimum number of treatment
repeats that should be present, if not, then the group is excluded from the calculation.
Behavior of cytominer-eval includes all single repeat measuments, marking them as non-replicating
this behaviour is replicated by setting this argument to 2. If 2, then only compounds with 2
or more repeats are included in the calculation and have the posibility of generating a score
for comparison to a null distribution and potentially passing the compactness test of being
greater than the Nth percentile of the null distribution. By default 2.</p></li>
<li><p><strong>max_cardinality</strong> (<em>int</em>) – If a dataset has thousands of matched repeats, then little is gained in
finding pairwise all-to-all distances of non-matching compounds, this
argument allows setting an upper bound cutoff after which, the repeats
are shuffled and max_cardinality samples drawn to create a synthetic set of
max_cardinality repeats. This is very useful when using a demanding similarity
method as it cuts the evaluations dramatically. By default 50.</p></li>
<li><p><strong>include_cardinality_violating_compounds_in_calculation</strong> (<em>bool</em>) – If True, then compounds for which there are no matching replicates, or not enough as defined
by min_cardinality (and are therefore deemed not compact) are included in the final
reported compactness statistics. If False, then they are not included as
non-compact and simply ignored as if they were not present in the dataset. By default
False.</p></li>
<li><p><strong>return_full_performance_df</strong> (<em>bool</em>) – If True, then a tuple is returned with the compactness score in the first position,
and a pd.DataFrame containing full information on each repeat. By default False</p></li>
<li><p><strong>performance_df_file</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>Path</em><em>, </em><em>bool</em><em>]</em><em>]</em>) – If return_full_performance_df is True and a Path or str is given as an argument to this
parameter, then the performance DataFrame is written out to a CSV file using this filename.
If True is passed here, then the a filename will be constructed from function arguments,
attempting to capture the run details. If an auto-generated file with this name exists,
then an error is raised and no calculations are performed. In addition to the output CSV,
a json file is also written capturing arguments that the function was called with. So if
‘compactness_results.csv’ is passed here, then a file named compactness_results.json will
be written out. If a filename is autogenerated, then the autogenerated filename is adapted
to have the ‘.json’ file extension. If the argument does not end in ‘.csv’, then .json is appended
to the end of the filename to define the name of the json file. By Default, None.</p></li>
<li><p><strong>additional_captured_params</strong> (<em>Optional</em><em>[</em><em>dict</em><em>]</em>) – If writing out full details, also include this dictionary in the output json file, useful
to add metadata to runs. By default None.</p></li>
<li><p><strong>similarity_metric_name</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – If relying on the function to make a nice performance CSV file name, then a nice succinct
similarity metric name may be passed here, rather than relying upon calling __repr__ on the
function, which may return long names such as:
‘bound method Phenotypic_Metric.similarity of Manhattan’. By default None.</p></li>
<li><p><strong>percentile_cutoff</strong> (<em>int</em>) – Percentile of the null distribution over which the matching replicates must score to be
considered compact. Should range from 0 to 100. By default 95.</p></li>
<li><p><strong>use_joblib_parallelisation</strong> (<em>bool</em>) – If True, then use joblib to parallelise evaluation of compounds. By default True.</p></li>
<li><p><strong>n_jobs</strong> (<em>int</em><em>, </em><em>optional</em>) – The n_jobs argument is passed to joblib for parallel execution and defines the number of
threads to use.  A value of -1 denotes that the system should determine how many jobs to run.
By default -1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>If return_full_performance_df is False, then only the percent compact statistic is returned.
If True, then a tuple is returned, with percent compact in the first position, and a
pd.DataFrame in the second position containing the median repeat scores, as well as median
null distribution scores in an easy to analyse format.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[float, tuple[float, pd.DataFrame]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.performance.percent_replicating">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.performance.</span></span><span class="sig-name descname"><span class="pre">percent_replicating</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><span class="pre">Dataset</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="phenonaut.html#phenonaut.phenonaut.Phenonaut" title="phenonaut.phenonaut.Phenonaut"><span class="pre">Phenonaut</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perturbation_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replicate_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replicate_criteria</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replicate_criteria_not</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">null_query_or_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">null_criteria</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">null_criteria_not</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restrict_evaluation_query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'spearman'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric_higher_is_better</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_cardinality</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_cardinality</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_cardinality_violating_compounds_in_calculation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_full_performance_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">additional_captured_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">performance_df_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile_cutoff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_joblib_parallelisation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.performance.percent_replicating" title="Permalink to this definition"></a></dt>
<dd><p>Calculate percent replicating</p>
<p>Percent replicating is defined by Way et. al. in:
Way, Gregory P., et al. “Morphology and gene expression profiling provide complementary
information for mapping cell state.” Cell systems 13.11 (2022): 911-923.
or on bioRxiv:
<a class="reference external" href="https://www.biorxiv.org/content/10.1101/2021.10.21.465335v2">https://www.biorxiv.org/content/10.1101/2021.10.21.465335v2</a></p>
<p>Helpful descriptions also exist in
<a class="reference external" href="https://github.com/cytomining/cytominer-eval/issues/21#issuecomment-902934931">https://github.com/cytomining/cytominer-eval/issues/21#issuecomment-902934931</a></p>
<p>This implementation is designed to work with a variety of phenotypic similarity methods, not
just a spearman correlation coefficient between observations.groupby_null</p>
<p>Matching distributions are created by matching perturbations. In Phenonaut, this is
typically defined by the perturbation_column field. This function takes this field as an
argument, although it is unused if found in the passed Dataset/Phenonaut object. Additional
criterial to match on such as concentration and well position can be added using the
replicate_criteria argument. Null distributions are composed of a pick of C unique compounds,
where C is the cardinality of the matched repeats (how many), and their median ‘similarity’.
By default, this similarity is the spearman correlation coefficient between profiles. This
process to generate median similarity for non-replicate compounds is repeated n_iters times
(by default 1000). Once the null distribution has been collected (median pairwise similarities),
the median similarity of matched replicates is compared to the 95th percentile of this null
distribution. If it is greater, then the compound (or compound and dose) are deemed replicating.
Null distributions may not contain the matched compound. The percent replicating is calculated
from the number of matched repeats which were replicating versus the number which were not.</p>
<p>As the calculation is demanding, the function makes use of the joblib library for parallel
calculation of the null distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>Union</em><em>[</em><a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><em>Dataset</em></a><em>, </em><a class="reference internal" href="phenonaut.html#phenonaut.phenonaut.Phenonaut" title="phenonaut.phenonaut.Phenonaut"><em>Phenonaut</em></a><em>, </em><em>pd.DataFrame</em><em>]</em><em>,</em>) – Input data in the form of a Phenonaut dataset, a Phenonaut object, or a pd.DataFrame
containing profiles of perturbations. If a Phenonaut object is supplied, then the last added
Dataset will be used.</p></li>
<li><p><strong>perturbation_column</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em>) – In the standard % replicating calculation, compounds, are matched by name (or identifier),
and dose, although this can be relaxed. This argument sets the column name
containing an identifier for the perturbation name (or identifier), usually the name of a
compound or similar. If a Phenonaut object or Dataset is supplied as the ds argument and this
perturbation_column argument is None, then this value is attempted to be discovered through
interrogation of the perturbation_column property of the Dataset. In the case of the CMAP_Level4
PackagedDataset, a standard run would be achieved by passing ‘pert_iname’as an argument here,
or disregarding the value found in this argument by providing a dataset with the
perturbation_column property already set.</p></li>
<li><p><strong>replicate_query</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em><em>=None</em>) – Optional pandas query to apply in selection of the matching replicates, this maybe something
like ensuring concentration is above a threshold, or that they are taken from certain timepoints.
Please note, if information in rows is never going to be included in matching or null distributions,
then it is more efficient to prefilter the dataframe before running percent_replicating on it.
This parameter should not be used to restrict the compounds on which percent replicating is run,
as this is inefficient. Instead, the restrict_evaluation_query should be used.</p></li>
<li><p><strong>replicate_criteria</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>]</em><em>=None</em>) – As noted above describing the impact of the perturbation_column argument, matching compounds
are often defined by their perturbation name/identifier and dose.  Whilst the perturbation
column matches the compound name/identifier (something which must always be matched), passing
a string here containing the title of a dose column (for example) also enforces matching on
this property. A list of strings may also be passed. In the case of the PackagedDataset
CMAP_Level4, this argument would take the value “pert_idose_uM” and would ensure that
matched replicates share a common identifier/name (as default and enforced by
perturbation_column) and concentration. The original perturbation_column may be included
here but has no effect. By default None.</p></li>
<li><p><strong>replicate_criteria_not</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>]</em><em>=None</em>) – Values in this list enforce that matching replicates do NOT share a common property. This is
useful for exotic evaluations, like picking replicates from across cell lines and
concentrations.</p></li>
<li><p><strong>null_query_or_df</strong> (<em>Optional</em><em>[</em><em>str</em><em>, </em><em>pd.DataFrame</em><em>]</em><em>=None</em>) – Optional pandas query to apply in selection of the non-matching replicates comprising the null
distribution. This can be things like ensuring only a certain plates or cell lines are used in
construction of the distribution. Alternatively, a pd.DataFrame may be supplied here, from which
the non-matching compounds are drawn for creation of the null distribution. Note; if
supplying a query to filter out  information in rows that is never going to be included in
matching or null distributions, then it is more efficient to prefilter the dataframe before
running percent_replicating on it. This argument does not override null_criteria, or
null_criteria_not as these have effect after this arguments effects have been applied. Has no
effect if None. By default, None.</p></li>
<li><p><strong>null_criteria</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>]</em>) – Whilst matching compounds are often defined by perturbation and dose, compounds comprising the
null distribution must sometimes match the well position of the original compound. This
argument captures the column name defining properties of non-matching replicates which must
match the orignal query compound. In the case of the CMAP_Level4 PackagedDataset, this
argument would take the value “well”. A list of strings may also be passed to enforce further
fields within the matching distribution which must match in the null distribution. If None,
then no requirements appart from a different name/compound idenfier are enforced. By default
None.</p></li>
<li><p><strong>null_criteria_not</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em><em>]</em>) – Values in this list enforce that matching non-replicates do NOT share a common property with
the chosen replicates. The opposite of the above described null_criteria, this
allows exotic evaluations like picking replicates from different cell lines to the matching
replicates. Has no effect if None. By default None.</p></li>
<li><p><strong>restrict_evaluation_query</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em><em>, </em><em>optional</em>) – If only a few compounds in a Phenonaut Dataset are to be included in the percent replicating
calculation, then this parameter may be used to efficiently select only the required compounds
using a standard pandas style query which is run on groups defined by replicate_criteria
Excluded compounds are not removed from the percent replicating calculation.  If None, then has
no effect. By default None.</p></li>
<li><p><strong>features</strong> (<em>features:Optional</em><em>[</em><em>list</em><em>[</em><em>str</em><em>]</em><em>]</em>) – Features list which capture the phenotypic responses to perturbations. Only required and used
if a pd.DataFrame is supplied in place of the ds argument. By default None.</p></li>
<li><p><strong>n_iters</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of times the non-matching compound replicates should be sampled to compose the null
distribution. If less than n_iters are available, then take as many as possible. By default
1000.</p></li>
<li><p><strong>similarity_metric</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>Callable</em><em>, </em><a class="reference internal" href="#phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric" title="phenonaut.metrics.non_ds_phenotypic_metrics.PhenotypicMetric"><em>PhenotypicMetric</em></a><em>]</em><em>, </em><em>optional</em>) – Callable metric, or string which is passed to pdist. This should be a
distance metric; that is, lower is better, higher is worse.
Note, a special case exists, whereby ‘spearman’ may be supplied here
if so, then a much faster Numpy method np.corrcoef is used, and then results
are subtracted from 1 to turn the metric into a distance metric. By default ‘spearman’.</p></li>
<li><p><strong>similarity_metric_higher_is_better</strong> (<em>bool</em>) – If True, then a high value from the supplied similarity metric is better. If False, then
a lower value is better (as is the case for distance metrics like Euclidean/Manhattan etc).
Note that if lower is better, then the percentile should be changed to the other end of the
distribution. For example, if keeping with significance at the 5 % level for a metric for
which higher is better, then a metric where lower is better would use the 5th percentile,
and percentile_cutoff = 5 should be used. By default True.</p></li>
<li><p><strong>min_cardinality</strong> (<em>int</em>) – Cardinality is the number of times a treatment is repeated (treatment with matching well,
dose and any other constraints imposed). This arguments sets the minimum number of treatment
repeats that should be present, if not, then the group is excluded from the calculation.
Behavior of cytominer-eval includes all single repeat measuments, marking them as non-replicating
this behaviour is replicated by setting this argument to 2. If 2, then only compounds with 2
or more repeats are included in the calculation and have the posibility of generating a score
for comparison to a null distribution and potentially passing the replicating test of being
greater than the Nth percentile of the null distribution. By default 2.</p></li>
<li><p><strong>max_cardinality</strong> (<em>int</em>) – If a dataset has thousands of matched repeats, then little is gained in
finding pairwise all-to-all distances of non-matching compounds, this
argument allows setting an upper bound cutoff after which, the repeats
are shuffled and max_cardinality samples drawn to create a synthetic set of
max_cardinality repeats. This is very useful when using a demanding similarity
method as it cuts the evaluations dramatically. By default 50.</p></li>
<li><p><strong>include_cardinality_violating_compounds_in_calculation</strong> (<em>bool</em>) – If True, then compounds for which there are no matching replicates, or not enough as defined
by min_cardinality (and are therefore deemed not replicating) are included in the final
reported percent replicating statistics. If False, then they are not included as
non-replicating and simply ignored as if they were not present in the dataset. By default
False.</p></li>
<li><p><strong>return_full_performance_df</strong> (<em>bool</em>) – If True, then a tuple is returned with the percent replicating score in the first position,
and a pd.DataFrame containing full information on each repeat. By default False</p></li>
<li><p><strong>performance_df_file</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>Path</em><em>, </em><em>bool</em><em>]</em><em>]</em>) – If return_full_performance_df is True and a Path or str is given as an argument to this
parameter, then the performance DataFrame is written out to a CSV file using this filename.
If True is passed here, then the a filename will be constructed from function arguments,
attempting to capture the run details. If an auto-generated file with this name exists,
then an error is raised and no calculations are performed. In addition to the output CSV,
a json file is also written capturing arguments that the function was called with. So if
‘pr_results.csv’ is passed here, then a file named pr_results.json will be written out.
If a filename is autogenerated, then the autogenerated filename is adapted to have the
‘.json’ file extension. If the argument does not end in ‘.csv’, then .json is appended
to the end of the filename to define the name of the json file. By Default, None.</p></li>
<li><p><strong>additional_captured_params</strong> (<em>Optional</em><em>[</em><em>dict</em><em>]</em>) – If writing out full details, also include this dictionary in the output json file, useful
to add metadata to runs. By default None.</p></li>
<li><p><strong>similarity_metric_name</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – If relying on the function to make a nice performance CSV file name, then a nice succinct
similarity metric name may be passed here, rather than relying upon calling __repr__ on the
function, which may return long names such as:
‘bound method Phenotypic_Metric.similarity of Manhattan’. By default None.</p></li>
<li><p><strong>percentile_cutoff</strong> (<em>int</em>) – Percentile of the null distribution over which the matching replicates must score to be
considered replicating. Should range from 0 to 100. By default 95.</p></li>
<li><p><strong>use_joblib_parallelisation</strong> (<em>bool</em>) – If True, then use joblib to parallelise evaluation of compounds. By default True.</p></li>
<li><p><strong>n_jobs</strong> (<em>int</em><em>, </em><em>optional</em>) – The n_jobs argument is passed to joblib for parallel execution and defines the number of
threads to use.  A value of -1 denotes that the system should determine how many jobs to run.
By default -1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>If return_full_performance_df is False, then only the percent replicating is returned.
If True, then a tuple is returned, with percent replicating in the first position, and a
pd.DataFrame in the second position containing the median repeat scores, as well as median
null distribution scores in an easy to analyse format.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[float, tuple[float, pd.DataFrame]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.performance.silhouette_score">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.performance.</span></span><span class="sig-name descname"><span class="pre">silhouette_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="phenonaut.data.html#phenonaut.data.dataset.Dataset" title="phenonaut.data.dataset.Dataset"><span class="pre">Dataset</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="phenonaut.html#phenonaut.phenonaut.Phenonaut" title="phenonaut.phenonaut.Phenonaut"><span class="pre">Phenonaut</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perturbation_column</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replicate_criteria</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Callable</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'euclidean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric_higher_is_better</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_full_performance_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#phenonaut.metrics.performance.silhouette_score" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-phenonaut.metrics.utils">
<span id="phenonaut-metrics-utils-module"></span><h2>phenonaut.metrics.utils module<a class="headerlink" href="#module-phenonaut.metrics.utils" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.utils.percent_compact_summarise_results">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.utils.</span></span><span class="sig-name descname"><span class="pre">percent_compact_summarise_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_or_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_glob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'pc_*.csv'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_percent_compact</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#phenonaut.metrics.utils.percent_compact_summarise_results" title="Permalink to this definition"></a></dt>
<dd><p>Summarise percent compact results</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_or_dir</strong> (<em>Union</em><em>[</em><em>Path</em><em>, </em><em>str</em><em>]</em>) – Percent compact results file, or directory containing results files.</p></li>
<li><p><strong>dir_glob</strong> (<em>str</em><em>, </em><em>optional</em>) – Glob to use in searching directories for percent replicating results
files, by default “pc_*.csv”.</p></li>
<li><p><strong>get_percent_compact</strong> (<em>bool</em>) – If True, then calculate and return percent compact in the table. Has no
effect if run on a file (not a directory). By default True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Either a tuple containing the percent compact and number of records
contributing to that score (if run on a single file), or a pd.DataFrame
summarising results (if run on a directory).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[Tuple[float, int], pd.DataFrame]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.utils.percent_replicating_results_dataframe_to_95pct_confidence_interval">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.utils.</span></span><span class="sig-name descname"><span class="pre">percent_replicating_results_dataframe_to_95pct_confidence_interval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile_cutoff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_resamples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric_higher_is_better</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#phenonaut.metrics.utils.percent_replicating_results_dataframe_to_95pct_confidence_interval" title="Permalink to this definition"></a></dt>
<dd><p>Get confidence interval at given percentile cutoff for percent replicating results</p>
<p>Reads a DataFrame from phenonaut.metrics.performance.percent_replicating
and performs bootstrapping, sampling from the null distribution to assign a
confidence interval at the given cutoff, or list of cutoffs.  Returns a tuple
containing upper and lower 95 % confidence interval bounds.  If multiple
percentile cutoffs are supplied, then a list containing tuples for each is returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – DataFrame supplied by phenonaut.metrics.performance.percent_replicating</p></li>
<li><p><strong>percentile_cutoff</strong> (<em>Union</em><em>[</em><em>int</em><em>, </em><em>float</em><em>, </em><em>list</em><em>[</em><em>Union</em><em>[</em><em>int</em><em>, </em><em>float</em><em>]</em><em>]</em><em>]</em>) – Percentile cutoff at which to calculate the confidence interval.  Can
also be a list, which results in a list of high and low confidence
interval tuples being returned. Should be between 0 and 100, with a value
of 95 denoting the 95th percentile as a cutoff. By default 95.</p></li>
<li><p><strong>n_resamples</strong> (<em>int</em>) – Number of times to resample the null distribution.  By default 1000.</p></li>
<li><p><strong>similarity_metric_higher_is_better</strong> (<em>bool</em>) – If True, then consider treatment replicating if score is greater than
the percentile cutoff.  If False, then consider treatment replicating if
score is less than percentile cutoff. By default True.</p></li>
<li><p><strong>defines</strong> (<em>n_jobs argument is passed to joblib for parallel execution and</em>) – number of threads to use.  A value of -1 denotes that the system should
determine how many jobs to run. By default -1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple containing 2 values, the first being the lower confidence interval
and the second being the higher confidence interval.  If multiple
percentile cutoffs are given, then a list of tuples at each percentile
cutoff will be returned.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[list[tuple[float, float]], tuple[float, float]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.utils.percent_replicating_results_dataframe_to_percentile_vs_percent_replicating">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.utils.</span></span><span class="sig-name descname"><span class="pre">percent_replicating_results_dataframe_to_percentile_vs_percent_replicating</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile_range</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0,</span> <span class="pre">101)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile_step_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric_higher_is_better</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#phenonaut.metrics.utils.percent_replicating_results_dataframe_to_percentile_vs_percent_replicating" title="Permalink to this definition"></a></dt>
<dd><p>Get x,y arrays for cutoff vs % replicating plots</p>
<p>Reads a DataFrame from phenonaut.metrics.performance.percent_replicating
when run with return_full_performance_df = True, and generates a tuple of
x and y coordinates, allowing plotting of percentile cutoff vs percent
replicating.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – DataFrame supplied by phenonaut.metrics.performance.percent_replicating</p></li>
<li><p><strong>percentile_range</strong> (<em>tuple</em><em>[</em><em>int</em><em>, </em><em>int</em><em>]</em><em>, </em><em>optional</em>) – The range of percentiles to cover, by default (0, 101)</p></li>
<li><p><strong>percentile_step_size</strong> (<em>int</em><em>, </em><em>optional</em>) – By default, every value in percentile_range is explored (-1 for the max
value inkeeping with Python range function operation), the stepsize may
be changed here. By default 1.</p></li>
<li><p><strong>return_counts</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, then y values denote the counts of replicates which were
deemed replicating. If False, then percent replicating is returned. By default
False</p></li>
<li><p><strong>similarity_metric_higher_is_better</strong> (<em>bool</em>) – If True, then consider treatment replicating if score is greater than
the percentile cutoff.  If False, then consider treatment replicating if
score is less than percentile cutoff. By default True.</p></li>
<li><p><strong>n_jobs</strong> (<em>int</em><em>, </em><em>optional</em>) – The n_jobs argument is passed to joblib for parallel execution and defines
number of threads to use.  A value of -1 denotes that the system should
determine how many jobs to run. By default -1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple containing 2 np.ndarrays, the first being percentile cutoff, and
the second being mathching % replicating values (or count of replicating
compounds if return_counts=True)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[np.ndarray, np.ndarray]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="phenonaut.metrics.utils.percent_replicating_summarise_results">
<span class="sig-prename descclassname"><span class="pre">phenonaut.metrics.utils.</span></span><span class="sig-name descname"><span class="pre">percent_replicating_summarise_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_or_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_glob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'pr_*.csv'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">if_no_json_use_filename_to_derive_info</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_percent_replicating</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#phenonaut.metrics.utils.percent_replicating_summarise_results" title="Permalink to this definition"></a></dt>
<dd><p>Summarise percent replicating results</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_or_dir</strong> (<em>Union</em><em>[</em><em>Path</em><em>, </em><em>str</em><em>]</em>) – Percent replicating results file, or directory containing results files.</p></li>
<li><p><strong>dir_glob</strong> (<em>str</em><em>, </em><em>optional</em>) – Glob to use in searching directories for percent replicating results
files, by default “pr_*.csv”.</p></li>
<li><p><strong>if_no_json_use_filename_to_derive_info</strong> (<em>bool</em><em>, </em><em>optional</em>) – Legacy runs of percent replicating did not produce a json information file
and therefore run information is attempted to be derived from filenames
if this parameter is True. By default True.</p></li>
<li><p><strong>get_percent_replicating</strong> (<em>bool</em>) – If True, then calculate and return PR in the table. Has no effect if
run on a file (not a directory). By default True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Either a tuple containing the percent replicating and number of records
contributing to that score (if run on a single file), or a pd.DataFrame
summarising results (if run on a directory).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[Tuple[float, int], pd.DataFrame]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-phenonaut.metrics">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-phenonaut.metrics" title="Permalink to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="phenonaut.data.html" class="btn btn-neutral float-left" title="phenonaut.data package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="phenonaut.output.html" class="btn btn-neutral float-right" title="phenonaut.output package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Steven Shave.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>